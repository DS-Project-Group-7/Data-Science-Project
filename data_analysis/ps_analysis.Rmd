---
title: "Painting Support Analysis"
date: '2022-09-18'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
art <- read.csv("../data/cleanData.csv")
art <- art %>%
  mutate(auxiliary_support_condition = recode(auxiliary_support_condition, "0" = "Poor", "1" = "Fair", "2" = "Good", "3" = "Excellent")) %>%
  mutate(media_condition = recode(media_condition, "0" = "Poor", "1" = "Fair", "2" = "Good", "3" = "Excellent")) %>%
  mutate(ground_condition = recode(ground_condition, "0" = "Poor", "1" = "Fair", "2" = "Good", "3" = "Excellent")) %>%
  mutate(painting_support_condition = recode(painting_support_condition, "0" = "Poor", "1" = "Fair", "2" = "Good", "3" = "Excellent")) %>%
  mutate(frame_condition = recode(frame_condition, "0" = "Poor", "1" = "Fair", "2" = "Good", "3" = "Excellent"))
```

```{r}
target_col <- c("collection", "auxiliary_support_condition", "media_condition", 
                "ground_condition", "painting_support_condition", "frame_condition")
conditions <- art[, target_col]
```

# Test independence between museum collection and auxiliary support condition
```{r}
aux_contingency <- table(conditions$collection, 
                         factor(conditions$auxiliary_support_condition, 
                                levels = c("Poor", "Fair", "Good")))
(test1 <- chisq.test(aux_contingency))
test1$expected
```
Here, we would like to test if there's an association between the museum collection and the condition of the auxiliary support. As we can see from the Pearson's chi-squared test from above, the $\chi^2$ statistics is 8.344, which is greater than the critical value $\chi^2_{0.95}(6)$ as the p-value 0.214 indicates, hence there is no association between the museum collection and the auxiliary support condition. However, one of the major problem here is that, given the sample size are small, the test statistics might not be approximated well by the $\chi^2$ distribution, as we can see there are one cell with expected counts less than 5. Therefore, a Fisher's exact test might be more appropriate.

```{r}
(test2 <- fisher.test(aux_contingency))
```
As we can see, the p-value returned by the Fisher's exact test is 0.2434, which is greater than the significance level of 0.05. Thus, there are no association between the two.

# Test independence between museum collection and painting support condition
```{r}
(ps_contingency <- table(conditions$collection, factor(conditions$painting_support_condition, 
                                                       levels = c("Poor", "Fair", "Good", "Excellent"))))
 
(test1 <- chisq.test(ps_contingency))
test1$expected
```
In the second test, we would like to test if there's an association between the museum collection and the painting support condition. As we can see from the deviance table above, the $\chi^2$ statistics is 4.870, which is less than the critical value $\chi^2_{0.95}(8)$ as the p-value is greater than the significant level of 0.05. Therefore, we do not reject the null hypothesis, and there's no association between museum collection and the painting support condition. However, we do notice there are several cells with expected count lower than 5. Thus, we will perform Fisher's exact test again.

```{r}
(test2 <- fisher.test(ps_contingency, workspace = 2e8))
```
As we can see that the returned p-value 0.5031 is greater than the significance level of 0.05, thus, the two variables are independent.

# Test independence between museum collection and paint layer condition
```{r}
pl_condition <- table(conditions$collection, factor(conditions$media_condition, 
                                                       levels = c("Poor", "Fair", "Good", "Excellent")))
(test1 <- chisq.test(pl_condition))
test1$expected
```
In the third test, we tested if there's an association between the museum collection and the paint layer condition. As we can see from the deviance table above, the $\chi^2$ statistics is 15.309, which is smaller than the critical value $\chi^2_{0.95}(7)$ as the p-value is greater than the significance level of 0.05. In this case, we would reject the null hypothesis, thus, there's an association between the two factors. Although, we did rejected the null hypothesis, we still could not trust the result, given that there are quite a few cells in the contingency tables with expected count less than 5, therefore the $\chi^2$ approximation may not be good enough and the Chi-square test is not appropriate, and in this case the Fisher's exact test is preferred.

```{r}
(test2 <- fisher.test(pl_condition, workspace = 2e8))
```
As we can see, the returned p-value is 0.005789, thus, we reject the null hypothesis, and there's an association between the museum collection and the paint layer condition.

```{r}
library(ggplot2)
library(ggstatsplot)
library(ggmosaic)
```

```{r}
pl_mosaic <- conditions %>%
  count(collection, media_condition)
pl_mosaic$media_condition <- factor(pl_mosaic$media_condition, levels = c("Poor", "Fair", "Good", "Excellent"))

ggplot(pl_mosaic) +
  geom_mosaic(aes(weight = n, x = product(media_condition), fill = collection)) +
  ggtitle("Paint Layer Condition Mosaic Plot") +
  theme(axis.text.y = element_blank(), legend.key.size = unit(0.4, 'cm'),
        legend.text = element_text(size=7)) +
  xlab("Paint Layer Condition") + 
  ylab("Museum Collection") +
  guides(fill=guide_legend(title="Museum Collection", reverse = TRUE))
```

